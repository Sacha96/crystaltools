#!/usr/bin/env bash
set -e
if [[ -z "${DIR_CT}" ]]; then 
    echo 'Make sure to source ct_init before calling this script.'
    exit 1
fi
source $DIR_CT/scripts/ct_init

v_check

rm -rf ~/.vmodules/despiegk/crystallib

#CHECK IF DIR EXISTS, IF NOT CLONE
if ! [[ -d "$HOME/.vmodules/despiegk/crystallib" ]]
then
    pushd $DIR_CODE
    if [[ -d "$DIR_CODE/crystallib" ]]
    then        
        cd $DIR_CODE/crystallib
        git pull
        cd ..
    else
        git clone https://github.com/crystaluniverse/crystallib
    fi
    # cd crystallib
    # git checkout refactor_publish_config
    # cd ..
    sudo rm -rf ~/.vmodules/despiegk/
    mkdir -p ~/.vmodules/despiegk/
    popd "$@" > /dev/null

    ln -s $DIR_CODE/crystallib ~/.vmodules/despiegk/crystallib

    v install patrickpissurno.redis
    v install despiegk.crystallib
    v install nedpals.vex

fi


